# 作業計画 (2025-11-30)

## 概要
- 指示1: S3 地図検索画面でPlaces SDKのAutoCompleteをSearchTextへ移行し、検索のoriginに現カメラ中心座標を用いる。
- 指示2: S1 買い物リスト画面の追加ボタン（FAB）の形状を丸型へ更新する。

## 関連ドキュメント / ファイル
- `requirements/document.md` (S1/S3仕様の参照元)
- `app/src/main/java/com/mapshoppinglist/ui/place/PlacePickerScreen.kt` (カメラ中心取得とUIイベント)
- `app/src/main/java/com/mapshoppinglist/ui/place/PlacePickerViewModel.kt` (検索ロジックと状態管理)
- `app/src/test/java/com/mapshoppinglist/ui/place/PlacePickerViewModelTest.kt` (ViewModel単体テスト)
- `app/src/androidTest/java/com/mapshoppinglist/ui/place/PlacePickerTest.kt` (S3 UIテスト)
- `app/src/main/java/com/mapshoppinglist/ui/home/ShoppingListScreen.kt` (S1 FAB定義)
- `app/src/androidTest/java/com/mapshoppinglist/ui/home/ShoppingListScreenTest.kt` (S1 UIテスト)

## タスク
1. 🟥 **SearchText移行要件の洗い出し**
   - Places SDKのSearchText API仕様を最新ドキュメントで確認し、AutoCompleteとの差異（リクエストフィールド、フィルタ、必要な緯度経度指定）を整理する。
   - 現行の`PlacePredictionUiModel`に追加が必要か（距離・種類など）を判断する。

2. 🟥 **PlacePickerViewModelのSearchText対応**
   - `onQueryChange`内の`FindAutocompletePredictionsRequest`を`SearchByTextRequest`へ置き換え、`origin`に地図中心座標を設定できるようにする（必要に応じて`PlacePickerUiState`へ`searchOrigin`等を追加）。
   - レスポンスを`PlacePredictionUiModel`へマッピングし、`FetchPlaceRequest`による詳細取得フローを維持する or SearchTextの`Place`情報活用を整理する。
   - エラー処理・ローディング状態・検索ジョブのキャンセルロジックが維持されることを確認する。

3. 🟥 **地図中心座標の取得とViewModel連携**
   - `PlacePickerScreen`で`rememberCameraPositionState()`から得られる`position.target`を`LaunchedEffect`等で監視し、ViewModelに検索用originとして渡すイベントを追加する（例: `onCameraMoved`コールバック）。
   - 既存の`cameraLocation`更新との二重管理を避けるよう設計し、権限未許可時/選択時のカメラ追従挙動を確認する。

4. 🟥 **S3関連テスト更新**
   - `PlacePickerViewModelTest`にSearchText用のFakeレスポンスを追加し、クエリ更新時に`origin`が反映されることを検証する。
   - `PlacePickerTest`（UI）にマップ中心更新イベント経由でViewModelへ座標が届くシナリオ、または既存テストへ断言を追加する。

5. 🟥 **S1 FAB形状変更**
   - `ShoppingListScreen`の`FloatingActionButton`に`shape = CircleShape`や`FloatingActionButtonDefaults`を設定し、既存テーマとの整合を確認する。
   - `MaterialTheme`のカラーパレットとのコントラストを再確認し、必要ならカラーやサイズの微調整案を検討する。

6. 🟥 **S1 UIテスト調整**
   - `ShoppingListScreenTest`でFAB形状変更によるレイアウト/クリック影響が無いか確認し、新たなアサーション（例: `assertHasClickAction` 維持）を追加する。

7. 🟥 **ビルド & リグレッション確認**
   - `./gradlew lintDebug testDebugUnitTest connectedDebugAndroidTest`等、既存のビルド/テストコマンドを実行して、S1/S3双方の変更による退行が無いことを保証する。
